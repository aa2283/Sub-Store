- name: Debug Network and Sync
        run: |
          # 1. 启动容器
          docker run -d --name substore-svc \
            -v ${{ github.workspace }}/sub-store-data:/opt/app/data \
            xream/sub-store
          
          # 2. 立即获取内网 IP
          CONTAINER_IP=$(docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' substore-svc)
          echo ">>> 容器内网 IP 是: $CONTAINER_IP"
          
          # 3. 测试容器内网端口是否开放 (3000是后端, 3001是前端)
          echo ">>> 测试端口连通性..."
          curl -I http://$CONTAINER_IP:3000/api/sync || echo "后端端口不可达"
          
          # 4. 强制触发同步 (注意这里用的是 3000 端口)
          echo ">>> 尝试通过内网 IP 触发同步..."
          curl -X GET "http://$CONTAINER_IP:3000/api/syncArtifacts"
          
          # 5. 等待并查看容器日志 (这是最关键的，看它为什么不出文件)
          sleep 10
          docker logs substore-svc
          
          # 最后提取文件并清理
          docker cp substore-svc:/opt/app/data/. ./output/
          docker stop substore-svc && docker rm substore-svc
